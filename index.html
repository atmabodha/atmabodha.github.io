<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vedanta Dataset Browser</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@1/css/pico.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <style>
        .container { padding-top: 2rem; }
        .verse-card { margin-top: 2rem; padding: 1.5rem; border-radius: 8px; background: #f8f9fa; border: 1px solid #e0e0e0; }
        .sanskrit { font-size: 1.4rem; color: #2c3e50; margin-bottom: 1rem; }
        footer { margin-top: 3rem; font-size: 0.8rem; opacity: 0.7; }
    </style>
</head>
<body>

    <main class="container">
        <hgroup>
            <h1>Vedanta Dataset Browser</h1>
            <h2>Explore the Bhagavad Gita & Upanishads</h2>
        </hgroup>

        <section id="selectors">
            <div class="grid">
                <label for="chapter">Chapter
                    <select id="chapter" disabled>
                        <option value="">Loading Chapters...</option>
                    </select>
                </label>

                <label for="verse">Verse
                    <select id="verse" disabled>
                        <option value="">Select Chapter First</option>
                    </select>
                </label>
            </div>
        </section>

        <section id="display">
            <div id="verse-content" class="verse-card" style="display:none;">
                <h3 id="verse-title"></h3>
                <p id="verse-sanskrit" class="sanskrit"></p>
                <hr>
                <p id="verse-translation"></p>
            </div>
        </section>

        <footer>
            Data sourced from <a href="https://github.com/atmabodha/Vedanta_Datasets">atmabodha/Vedanta_Datasets</a>
        </footer>
    </main>

    <script>
        const CSV_URL = 'https://raw.githubusercontent.com/atmabodha/Vedanta_Datasets/master/Bhagavad_Gita/gita.csv';
        let fullData = [];

        // 1. Fetch and Parse CSV
        Papa.parse(CSV_URL, {
            download: true,
            header: true,
            complete: function(results) {
                fullData = results.data;
                initApp();
            }
        });

        function initApp() {
            const chapterSelect = document.getElementById('chapter');
            
            // Get unique chapters
            const chapters = [...new Set(fullData.map(item => item.chapter))].filter(Boolean);
            
            chapterSelect.innerHTML = '<option value="">Select a Chapter</option>';
            chapters.forEach(ch => {
                const opt = document.createElement('option');
                opt.value = ch;
                opt.textContent = `Chapter ${ch}`;
                chapterSelect.appendChild(opt);
            });
            
            chapterSelect.disabled = false;
        }

        // 2. Handle Chapter Selection
        document.getElementById('chapter').addEventListener('change', function(e) {
            const chapterVal = e.target.value;
            const verseSelect = document.getElementById('verse');
            const display = document.getElementById('verse-content');
            
            display.style.display = 'none';
            verseSelect.innerHTML = '<option value="">Select a Verse</option>';
            
            if (chapterVal) {
                const verses = fullData.filter(item => item.chapter === chapterVal);
                verses.forEach(v => {
                    const opt = document.createElement('option');
                    opt.value = v.verse;
                    opt.textContent = `Verse ${v.verse}`;
                    verseSelect.appendChild(opt);
                });
                verseSelect.disabled = false;
            } else {
                verseSelect.disabled = true;
            }
        });

        // 3. Handle Verse Selection
        document.getElementById('verse').addEventListener('change', function(e) {
            const verseVal = e.target.value;
            const chapterVal = document.getElementById('chapter').value;
            const display = document.getElementById('verse-content');

            if (verseVal && chapterVal) {
                const entry = fullData.find(item => item.chapter === chapterVal && item.verse === verseVal);
                
                if (entry) {
                    document.getElementById('verse-title').textContent = `Chapter ${chapterVal}, Verse ${verseVal}`;
                    document.getElementById('verse-sanskrit').textContent = entry.text || entry.sanskrit || "Sanskrit text not found";
                    document.getElementById('verse-translation').textContent = entry.translation || entry.english || "Translation not found";
                    display.style.display = 'block';
                }
            }
        });
    </script>
</body>
</html>
